<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cubist Regresion Models • Cubist</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/united/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/all.min.css" integrity="sha256-PbSmjxuVAzJ6FPvNYsrXygfGhNJYyZ2GktDbkMBqQZg=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/v4-shims.min.css" integrity="sha256-A6jcAdwFD48VMjlI3GDxUd+eCQa7/KWy6G9oe/ovaPA=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Cubist Regresion Models">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Cubist</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/cubist.html">Introduction</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="cubist_files/jquery-1.11.3/jquery.min.js"></script><script src="cubist_files/elevate-section-attrs-2.0/elevate-section-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Cubist Regresion Models</h1>
            
      
      
      <div class="hidden name"><code>cubist.Rmd</code></div>

    </div>

    
    
<p><code>Cubist</code> is an <code>R</code> port of the Cubist GPL <code>C</code> code released by RuleQuest at <a href="http://rulequest.com/cubist-info.html"><code>http://rulequest.com/cubist-info.html</code></a>. See the last section of this document for information on the porting. The other parts describes the functionality of the <code>R</code> package.</p>
<div id="model-trees" class="section level2">
<h2 class="hasAnchor">
<a href="#model-trees" class="anchor"></a>Model Trees</h2>
<p>Cubist is a rule–based model that is an extension of Quinlan’s M5 model tree. A tree is grown where the terminal leaves contain linear regression models. These models are based on the predictors used in previous splits. Also, there are intermediate linear models at each step of the tree. A prediction is made using the linear regression model at the terminal node of the tree, but is “smoothed” by taking into account the prediction from the linear model in the previous node of the tree (which also occurs recursively up the tree). The tree is reduced to a set of rules, which initially are paths from the top of the tree to the bottom. Rules are eliminated via pruning and/or combined for simplification.</p>
<p>This is explained better in Quinlan (1992). Wang and Witten (1997) attempted to recreate this model using a “rational reconstruction” of Quinlan (1992) that is the basis for the <code>M5P</code> model in <code>Weka</code> (and the R package <code>RWeka</code>).</p>
<p>An example of a model tree can be illustrated using the Boston Housing data in the <code>mlbench</code> package.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(Cubist)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(mlbench)</span>
<span id="cb1-3"><a href="#cb1-3"></a></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(BostonHousing)</span>
<span id="cb1-5"><a href="#cb1-5"></a>BostonHousing<span class="op">$</span>chas &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(BostonHousing<span class="op">$</span>chas) <span class="op">-</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb1-6"><a href="#cb1-6"></a></span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="kw"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="dv">1</span>)</span>
<span id="cb1-8"><a href="#cb1-8"></a>inTrain &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(<span class="dv">1</span><span class="op">:</span><span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(BostonHousing), <span class="kw"><a href="https://rdrr.io/r/base/Round.html">floor</a></span>(.<span class="dv">8</span><span class="op">*</span><span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(BostonHousing)))</span>
<span id="cb1-9"><a href="#cb1-9"></a></span>
<span id="cb1-10"><a href="#cb1-10"></a>train_pred &lt;-<span class="st"> </span>BostonHousing[ inTrain, <span class="dv">-14</span>]</span>
<span id="cb1-11"><a href="#cb1-11"></a>test_pred  &lt;-<span class="st"> </span>BostonHousing[<span class="op">-</span>inTrain, <span class="dv">-14</span>]</span>
<span id="cb1-12"><a href="#cb1-12"></a></span>
<span id="cb1-13"><a href="#cb1-13"></a>train_resp &lt;-<span class="st"> </span>BostonHousing<span class="op">$</span>medv[ inTrain]</span>
<span id="cb1-14"><a href="#cb1-14"></a>test_resp  &lt;-<span class="st"> </span>BostonHousing<span class="op">$</span>medv[<span class="op">-</span>inTrain]</span>
<span id="cb1-15"><a href="#cb1-15"></a></span>
<span id="cb1-16"><a href="#cb1-16"></a>model_tree &lt;-<span class="st"> </span><span class="kw"><a href="../reference/cubist.default.html">cubist</a></span>(<span class="dt">x =</span> train_pred, <span class="dt">y =</span> train_resp)</span>
<span id="cb1-17"><a href="#cb1-17"></a>model_tree</span></code></pre></div>
<pre><code>## 
## Call:
## cubist.default(x = train_pred, y = train_resp)
## 
## Number of samples: 404 
## Number of predictors: 13 
## 
## Number of committees: 1 
## Number of rules: 5</code></pre>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(model_tree)</span></code></pre></div>
<pre><code>## 
## Call:
## cubist.default(x = train_pred, y = train_resp)
## 
## 
## Cubist [Release 2.07 GPL Edition]  Tue Jan  7 12:20:02 2020
## ---------------------------------
## 
##     Target attribute `outcome'
## 
## Read 404 cases (14 attributes) from undefined.data
## 
## Model:
## 
##   Rule 1: [77 cases, mean 14.04, range 5 to 27.5, est err 2.14]
## 
##     if
##  nox &gt; 0.668
##     then
##  outcome = -2.18 + 3.47 dis + 21.6 nox - 0.32 lstat + 0.0089 b
##            - 0.12 ptratio - 0.02 crim - 0.005 age
## 
##   Rule 2: [167 cases, mean 19.30, range 7 to 31, est err 2.15]
## 
##     if
##  nox &lt;= 0.668
##  lstat &gt; 9.53
##     then
##  outcome = 43.02 - 0.94 ptratio - 0.27 lstat - 0.84 dis - 0.034 age
##            + 0.0082 b - 0.1 indus + 0.4 rm
## 
##   Rule 3: [29 cases, mean 25.08, range 18.2 to 50, est err 2.64]
## 
##     if
##  rm &lt;= 6.226
##  lstat &lt;= 9.53
##     then
##  outcome = -18.07 + 3.91 crim - 1.67 lstat + 0.0834 b + 3.3 rm
## 
##   Rule 4: [143 cases, mean 29.49, range 16.5 to 50, est err 2.39]
## 
##     if
##  dis &gt; 2.3999
##  lstat &lt;= 9.53
##     then
##  outcome = -28.26 + 11.1 rm + 0.62 crim - 0.58 lstat - 0.017 tax
##            - 0.059 age + 11.3 nox - 0.58 dis - 0.52 ptratio
## 
##   Rule 5: [14 cases, mean 40.54, range 22 to 50, est err 5.28]
## 
##     if
##  rm &gt; 6.226
##  dis &lt;= 2.3999
##  lstat &lt;= 9.53
##     then
##  outcome = -5.27 + 3.14 crim - 5.18 dis - 1.22 lstat + 9.6 rm
##            - 0.0141 tax - 0.031 age - 0.39 ptratio
## 
## 
## Evaluation on training data (404 cases):
## 
##     Average  |error|               2.13
##     Relative |error|               0.31
##     Correlation coefficient        0.96
## 
## 
##  Attribute usage:
##    Conds  Model
## 
##     82%   100%    lstat
##     57%    51%    nox
##     37%    93%    dis
##     10%    82%    rm
##            93%    age
##            93%    ptratio
##            63%    b
##            61%    crim
##            39%    indus
##            37%    tax
## 
## 
## Time: 0.0 secs</code></pre>
<p>There is no formula method for <code>cubist</code>; the predictors are specified as matrix or data frame and the outcome is a numeric vector.</p>
<p>There is a predict method for the model:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>model_tree_pred &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(model_tree, test_pred)</span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="co">## Test set RMSE</span></span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="kw"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>((model_tree_pred <span class="op">-</span><span class="st"> </span>test_resp)<span class="op">^</span><span class="dv">2</span>))</span></code></pre></div>
<pre><code>## [1] 3.72</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="co">## Test set R^2</span></span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="kw"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span>(model_tree_pred, test_resp)<span class="op">^</span><span class="dv">2</span></span></code></pre></div>
<pre><code>## [1] 0.773</code></pre>
</div>
<div id="ensembles-by-committees" class="section level2">
<h2 class="hasAnchor">
<a href="#ensembles-by-committees" class="anchor"></a>Ensembles By Committees</h2>
<p>The Cubist model can also use a boosting–like scheme called <em>committees</em> where iterative model trees are created in sequence. The first tree follows the procedure described in the last section. Subsequent trees are created using adjusted versions to the training set outcome: if the model over–predicted a value, the response is adjusted downward for the next model (and so on). Unlike traditional boosting, stage weights for each committee are not used to average the predictions from each model tree; the final prediction is a simple average of the predictions from each model tree.</p>
<p>The <code>committee</code> option can be used to control number of model trees:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="kw"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="dv">1</span>)</span>
<span id="cb9-2"><a href="#cb9-2"></a>com_model &lt;-<span class="st"> </span><span class="kw"><a href="../reference/cubist.default.html">cubist</a></span>(<span class="dt">x =</span> train_pred, <span class="dt">y =</span> train_resp, <span class="dt">committees =</span> <span class="dv">5</span>)</span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(com_model)</span></code></pre></div>
<pre><code>## 
## Call:
## cubist.default(x = train_pred, y = train_resp, committees = 5)
## 
## 
## Cubist [Release 2.07 GPL Edition]  Tue Jan  7 12:20:02 2020
## ---------------------------------
## 
##     Target attribute `outcome'
## 
## Read 404 cases (14 attributes) from undefined.data
## 
## Model 1:
## 
##   Rule 1/1: [77 cases, mean 14.04, range 5 to 27.5, est err 2.14]
## 
##     if
##  nox &gt; 0.668
##     then
##  outcome = -2.18 + 3.47 dis + 21.6 nox - 0.32 lstat + 0.0089 b
##            - 0.12 ptratio - 0.02 crim - 0.005 age
## 
##   Rule 1/2: [167 cases, mean 19.30, range 7 to 31, est err 2.15]
## 
##     if
##  nox &lt;= 0.668
##  lstat &gt; 9.53
##     then
##  outcome = 43.02 - 0.94 ptratio - 0.27 lstat - 0.84 dis - 0.034 age
##            + 0.0082 b - 0.1 indus + 0.4 rm
## 
##   Rule 1/3: [29 cases, mean 25.08, range 18.2 to 50, est err 2.64]
## 
##     if
##  rm &lt;= 6.226
##  lstat &lt;= 9.53
##     then
##  outcome = -18.07 + 3.91 crim - 1.67 lstat + 0.0834 b + 3.3 rm
## 
##   Rule 1/4: [143 cases, mean 29.49, range 16.5 to 50, est err 2.39]
## 
##     if
##  dis &gt; 2.3999
##  lstat &lt;= 9.53
##     then
##  outcome = -28.26 + 11.1 rm + 0.62 crim - 0.58 lstat - 0.017 tax
##            - 0.059 age + 11.3 nox - 0.58 dis - 0.52 ptratio
## 
##   Rule 1/5: [14 cases, mean 40.54, range 22 to 50, est err 5.28]
## 
##     if
##  rm &gt; 6.226
##  dis &lt;= 2.3999
##  lstat &lt;= 9.53
##     then
##  outcome = -5.27 + 3.14 crim - 5.18 dis - 1.22 lstat + 9.6 rm
##            - 0.0141 tax - 0.031 age - 0.39 ptratio
## 
## Model 2:
## 
##   Rule 2/1: [58 cases, mean 14.03, range 5 to 36, est err 4.06]
## 
##     if
##  dis &gt; 1.4254
##  dis &lt;= 1.8956
##  lstat &gt; 5.91
##     then
##  outcome = 86.06 - 20.56 dis - 0.47 lstat - 3 rm - 0.0201 b - 0.17 crim
##            - 4.1 nox
## 
##   Rule 2/2: [159 cases, mean 19.56, range 8.7 to 27.1, est err 1.84]
## 
##     if
##  rm &lt;= 6.251
##  dis &gt; 1.8956
##     then
##  outcome = -0.22 + 3.8 rm - 0.076 age + 0.021 b + 11.6 nox - 0.56 ptratio
##            - 0.04 lstat - 0.06 dis
## 
##   Rule 2/3: [116 cases, mean 22.43, range 7.2 to 50, est err 2.23]
## 
##     if
##  rm &gt; 6.251
##  lstat &gt; 5.91
##     then
##  outcome = -23.67 + 8.5 rm - 0.46 lstat - 0.3 crim - 0.0088 tax + 6.5 nox
##            - 0.2 dis - 0.19 ptratio + 0.0028 b - 0.008 age
## 
##   Rule 2/4: [10 cases, mean 25.07, range 5 to 50, est err 8.00]
## 
##     if
##  rm &lt;= 6.251
##  dis &lt;= 1.4254
##     then
##  outcome = 174.32 - 119.61 dis - 1.31 lstat + 38.6 nox
## 
##   Rule 2/5: [8 cases, mean 27.56, range 22.5 to 50, est err 3.33]
## 
##     if
##  rm &lt;= 6.461
##  lstat &lt;= 5.91
##     then
##  outcome = 22.34 + 6.98 crim
## 
##   Rule 2/6: [37 cases, mean 36.09, range 22.8 to 50, est err 3.40]
## 
##     if
##  rm &gt; 6.461
##  tax &gt; 265
##  lstat &lt;= 5.91
##     then
##  outcome = 53.88 - 0.2698 b + 0.0588 tax + 11.5 rm + 0.52 crim - 1.83 dis
##            - 0.129 age - 0.3 lstat - 0.12 ptratio
## 
##   Rule 2/7: [47 cases, mean 36.19, range 24.4 to 50, est err 3.56]
## 
##     if
##  rm &gt; 6.461
##  tax &lt;= 265
##     then
##  outcome = -23.33 - 0.0943 tax + 13.6 rm + 0.84 crim - 0.0276 b
##            - 0.21 lstat - 0.09 ptratio - 0.09 dis - 0.005 age + 0.006 zn
## 
## Model 3:
## 
##   Rule 3/1: [33 cases, mean 13.98, range 5 to 23.2, est err 2.95]
## 
##     if
##  nox &gt; 0.668
##  b &gt; 375.52
##     then
##  outcome = 197.68 - 0.3916 b - 0.5 age + 36.1 nox - 0.36 lstat
##            - 0.08 crim
## 
##   Rule 3/2: [44 cases, mean 14.09, range 7 to 27.5, est err 2.58]
## 
##     if
##  nox &gt; 0.668
##  b &lt;= 375.52
##     then
##  outcome = 14.76 - 0.3 lstat + 0.0196 b
## 
##   Rule 3/3: [241 cases, mean 17.54, range 5 to 31, est err 2.50]
## 
##     if
##  lstat &gt; 9.53
##     then
##  outcome = 49.71 - 1.16 dis - 0.32 lstat - 1.06 ptratio - 14.8 nox
##            + 0.0091 b + 0.9 rm + 0.07 rad - 0.017 age - 0.0023 tax
##            - 0.03 crim
## 
##   Rule 3/4: [29 cases, mean 25.08, range 18.2 to 50, est err 3.71]
## 
##     if
##  rm &lt;= 6.226
##  lstat &lt;= 9.53
##     then
##  outcome = -71.35 + 3.01 crim + 0.1693 b - 1.96 lstat + 5.5 rm
##            + 0.47 indus + 0.0173 tax
## 
##   Rule 3/5: [134 cases, mean 31.94, range 16.5 to 50, est err 2.79]
## 
##     if
##  rm &gt; 6.226
##  lstat &lt;= 9.53
##     then
##  outcome = -13.33 + 1.72 crim + 9.9 rm - 0.87 lstat - 0.86 dis
##            - 0.73 ptratio - 0.045 age - 0.0033 tax
## 
## Model 4:
## 
##   Rule 4/1: [17 cases, mean 11.90, range 8.4 to 17.8, est err 1.86]
## 
##     if
##  nox &gt; 0.693
##  lstat &gt; 19.52
##     then
##  outcome = 12.1 - 0.64 crim + 2 rm - 0.18 ptratio - 3.1 nox
## 
##   Rule 4/2: [38 cases, mean 12.67, range 5 to 23.7, est err 3.61]
## 
##     if
##  nox &lt;= 0.693
##  dis &gt; 1.4254
##  lstat &gt; 19.52
##     then
##  outcome = 112.54 - 116.7 nox - 4.67 dis - 0.109 age - 0.0155 b
##            - 0.008 tax
## 
##   Rule 4/3: [70 cases, mean 18.02, range 9.6 to 27.5, est err 1.96]
## 
##     if
##  crim &gt; 1.42502
##  dis &gt; 1.4254
##  lstat &gt; 5.91
##  lstat &lt;= 19.52
##     then
##  outcome = 28.61 - 0.9 lstat + 0.0105 b - 0.027 age - 0.06 crim + 3 nox
## 
##   Rule 4/4: [61 cases, mean 18.76, range 12.7 to 25, est err 1.92]
## 
##     if
##  crim &gt; 0.21977
##  crim &lt;= 1.42502
##  rm &lt;= 6.546
##  lstat &gt; 5.91
##     then
##  outcome = -8.96 + 6.4 rm - 0.108 age - 0.09 lstat + 0.0017 b
##            - 0.07 ptratio - 0.07 dis - 0.0008 tax - 0.01 crim
## 
##   Rule 4/5: [112 cases, mean 21.60, range 13.6 to 29.4, est err 1.67]
## 
##     if
##  crim &lt;= 0.21977
##  rm &lt;= 6.546
##  lstat &lt;= 19.52
##     then
##  outcome = -37.71 + 18.25 crim + 7.3 rm + 0.0451 b - 0.0149 tax
##            + 0.32 lstat - 0.068 age
## 
##   Rule 4/6: [9 cases, mean 22.30, range 5 to 50, est err 11.24]
## 
##     if
##  rm &lt;= 6.546
##  dis &lt;= 1.4254
##  lstat &gt; 5.91
##     then
##  outcome = 216.66 - 123.39 dis - 1.52 lstat + 31.4 nox - 5.1 rm
## 
##   Rule 4/7: [8 cases, mean 27.56, range 22.5 to 50, est err 5.10]
## 
##     if
##  rm &lt;= 6.461
##  lstat &lt;= 5.91
##     then
##  outcome = 93.41 - 2.79 lstat - 11.5 rm + 37.5 nox + 0.49 crim
##            - 0.0023 tax - 0.05 ptratio
## 
##   Rule 4/8: [118 cases, mean 32.26, range 7.5 to 50, est err 4.39]
## 
##     if
##  rm &gt; 6.546
##     then
##  outcome = -12.45 - 0.0364 tax + 8.1 rm - 0.05 lstat - 0.12 dis
##            - 0.007 age - 0.08 ptratio - 0.02 indus - 0.01 crim
## 
##   Rule 4/9: [37 cases, mean 36.09, range 22.8 to 50, est err 4.24]
## 
##     if
##  rm &gt; 6.461
##  tax &gt; 265
##  lstat &lt;= 5.91
##     then
##  outcome = 52.87 - 0.2742 b + 2.81 crim + 12 rm + 0.0478 tax - 0.151 age
##            - 1.73 dis - 0.06 lstat - 0.9 nox
## 
##   Rule 4/10: [33 cases, mean 37.05, range 25 to 50, est err 3.64]
## 
##     if
##  tax &lt;= 265
##  lstat &lt;= 5.91
##     then
##  outcome = -21.76 - 0.1186 tax + 1.59 crim + 13.2 rm - 0.33 lstat
##            - 4.6 nox - 0.16 ptratio
## 
## Model 5:
## 
##   Rule 5/1: [324 cases, mean 19.78, range 5 to 50, est err 2.75]
## 
##     if
##  rm &lt;= 6.781
##     then
##  outcome = 46.87 - 0.47 lstat - 1.05 dis - 14.9 nox - 0.78 ptratio
##            + 0.0104 b + 0.4 rm + 0.02 rad - 0.0006 tax
## 
##   Rule 5/2: [80 cases, mean 35.32, range 7.5 to 50, est err 4.52]
## 
##     if
##  rm &gt; 6.781
##     then
##  outcome = -49.93 + 13 rm - 0.83 crim - 0.19 lstat - 0.52 dis
##            - 0.45 ptratio - 6.3 nox + 0.0049 b + 0.04 rad - 0.0017 tax
##            + 0.007 zn
## 
##   Rule 5/3: [77 cases, mean 35.75, range 22.5 to 50, est err 3.93]
## 
##     if
##  lstat &lt;= 5.91
##     then
##  outcome = -10.9 + 4.64 crim - 2.66 lstat + 9.2 rm - 0.26 indus
##            - 0.84 dis - 0.12 ptratio + 0.02 rad - 1.5 nox - 0.0008 tax
##            + 0.0014 b
## 
## 
## Evaluation on training data (404 cases):
## 
##     Average  |error|               1.82
##     Relative |error|               0.26
##     Correlation coefficient        0.97
## 
## 
##  Attribute usage:
##    Conds  Model
## 
##     62%    97%    lstat
##     57%    88%    rm
##     22%    84%    dis
##     16%    66%    nox
##     10%    68%    crim
##      7%    71%    tax
##      3%    79%    b
##            80%    ptratio
##            69%    age
##            31%    rad
##            17%    indus
##             5%    zn
## 
## 
## Time: 0.0 secs</code></pre>
<p>For this model:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>com_pred &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(com_model, test_pred)</span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="co">## RMSE</span></span>
<span id="cb11-3"><a href="#cb11-3"></a><span class="kw"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>((com_pred <span class="op">-</span><span class="st"> </span>test_resp)<span class="op">^</span><span class="dv">2</span>))</span></code></pre></div>
<pre><code>## [1] 4.5</code></pre>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="co">## R^2</span></span>
<span id="cb13-2"><a href="#cb13-2"></a><span class="kw"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span>(com_pred, test_resp)<span class="op">^</span><span class="dv">2</span></span></code></pre></div>
<pre><code>## [1] 0.688</code></pre>
</div>
<div id="instancebased-corrections" class="section level2">
<h2 class="hasAnchor">
<a href="#instancebased-corrections" class="anchor"></a>Instance–Based Corrections</h2>
<p>Another innovation in Cubist using nearest–neighbors to adjust the predictions from the rule–based model. First, a model tree (with or without committees) is created. Once a sample is predicted by this model, Cubist can find it’s nearest neighbors and determine the average of these training set points. See Quinlan (1993a) for the details of the adjustment.</p>
<p>The development of rules and committees is independent of the choice of using instances. The original <code>C</code> code allowed the program to choose whether to use instances, not use them or let the program decide. Our approach is to build a model with the <code>cubist</code> function that is ignorant to the decision about instances. When samples are predicted, the argument <code>neighbors</code> can be used to adjust the rule–based model predictions (or not).</p>
<p>We can add instances to the previously fit committee model:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>inst_pred &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(com_model, test_pred, <span class="dt">neighbors =</span> <span class="dv">5</span>)</span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="co">## RMSE</span></span>
<span id="cb15-3"><a href="#cb15-3"></a><span class="kw"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>((inst_pred <span class="op">-</span><span class="st"> </span>test_resp)<span class="op">^</span><span class="dv">2</span>))</span></code></pre></div>
<pre><code>## [1] 4.64</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="co">## R^2</span></span>
<span id="cb17-2"><a href="#cb17-2"></a><span class="kw"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span>(inst_pred, test_resp)<span class="op">^</span><span class="dv">2</span></span></code></pre></div>
<pre><code>## [1] 0.688</code></pre>
<p>Note that the previous models used the implicit default of <code>neighbors = 0</code> for their predictions.</p>
<p>To tune the model over different values of <code>neighbors</code> and <code>committees</code>, the <code>train</code> function in the <a href="https://CRAN.R-project.org/package=caret">`caret</a> package can be used to optimize these parameters. For example:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(caret)</span>
<span id="cb19-2"><a href="#cb19-2"></a></span>
<span id="cb19-3"><a href="#cb19-3"></a>grid &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span>(<span class="dt">committees =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">50</span>, <span class="dv">100</span>),</span>
<span id="cb19-4"><a href="#cb19-4"></a>                    <span class="dt">neighbors =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">9</span>))</span>
<span id="cb19-5"><a href="#cb19-5"></a><span class="kw"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="dv">1</span>)</span>
<span id="cb19-6"><a href="#cb19-6"></a>boston_tuned &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span>(</span>
<span id="cb19-7"><a href="#cb19-7"></a>  <span class="dt">x =</span> train_pred,</span>
<span id="cb19-8"><a href="#cb19-8"></a>  <span class="dt">y =</span> train_resp,</span>
<span id="cb19-9"><a href="#cb19-9"></a>  <span class="dt">method =</span> <span class="st">"cubist"</span>,</span>
<span id="cb19-10"><a href="#cb19-10"></a>  <span class="dt">tuneGrid =</span> grid,</span>
<span id="cb19-11"><a href="#cb19-11"></a>  <span class="dt">trControl =</span> <span class="kw"><a href="https://rdrr.io/pkg/caret/man/trainControl.html">trainControl</a></span>(<span class="dt">method =</span> <span class="st">"cv"</span>)</span>
<span id="cb19-12"><a href="#cb19-12"></a>  )</span>
<span id="cb19-13"><a href="#cb19-13"></a>boston_tuned</span></code></pre></div>
<pre><code>## Cubist 
## 
## 404 samples
##  13 predictor
## 
## No pre-processing
## Resampling: Cross-Validated (10 fold) 
## Summary of sample sizes: 364, 364, 364, 363, 364, 363, ... 
## Resampling results across tuning parameters:
## 
##   committees  neighbors  RMSE  Rsquared  MAE 
##     1         0          3.49  0.870     2.41
##     1         1          3.48  0.877     2.35
##     1         5          3.23  0.891     2.17
##     1         9          3.27  0.886     2.20
##    10         0          2.98  0.903     2.11
##    10         1          2.88  0.912     2.07
##    10         5          2.73  0.919     1.91
##    10         9          2.76  0.917     1.91
##    50         0          3.01  0.900     2.11
##    50         1          2.90  0.911     2.06
##    50         5          2.71  0.920     1.88
##    50         9          2.74  0.917     1.90
##   100         0          2.97  0.903     2.09
##   100         1          2.87  0.913     2.04
##   100         5          2.67  0.922     1.86
##   100         9          2.71  0.919     1.88
## 
## RMSE was used to select the optimal model using the smallest value.
## The final values used for the model were committees = 100 and neighbors = 5.</code></pre>
<p>The next figure shows the profiles of the tuning parameters produced using <code>ggplot(boston_tuned)</code>.</p>
<p><img src="cubist_files/figure-html/plot-tune-1.png" width="700"></p>
<p>It may also be useful to see how the different models fit a single predictor:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a>lstat_df &lt;-<span class="st"> </span>train_pred[, <span class="st">"lstat"</span>, drop =<span class="st"> </span><span class="ot">FALSE</span>]</span>
<span id="cb21-2"><a href="#cb21-2"></a>rules_only &lt;-<span class="st"> </span><span class="kw"><a href="../reference/cubist.default.html">cubist</a></span>(<span class="dt">x =</span> lstat_df, <span class="dt">y =</span> train_resp)</span>
<span id="cb21-3"><a href="#cb21-3"></a>rules_and_com &lt;-<span class="st"> </span><span class="kw"><a href="../reference/cubist.default.html">cubist</a></span>(<span class="dt">x =</span> lstat_df, <span class="dt">y =</span> train_resp, <span class="dt">committees =</span> <span class="dv">100</span>)</span>
<span id="cb21-4"><a href="#cb21-4"></a></span>
<span id="cb21-5"><a href="#cb21-5"></a>predictions &lt;-<span class="st"> </span>lstat_df</span>
<span id="cb21-6"><a href="#cb21-6"></a>predictions<span class="op">$</span>medv &lt;-<span class="st"> </span>train_resp</span>
<span id="cb21-7"><a href="#cb21-7"></a>predictions<span class="op">$</span>rules_neigh &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(rules_only, lstat_df, <span class="dt">neighbors =</span> <span class="dv">5</span>)</span>
<span id="cb21-8"><a href="#cb21-8"></a>predictions<span class="op">$</span>committees &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(rules_and_com, lstat_df)</span></code></pre></div>
<p>The figure below shows the model fits for the test data. For these data, there doesn’t appear to be much of a improvement when committees or instances are added to the based rules.</p>
<p><img src="cubist_files/figure-html/lstatPlot-1.png" width="700"></p>
</div>
<div id="variable-importance" class="section level2">
<h2 class="hasAnchor">
<a href="#variable-importance" class="anchor"></a>Variable Importance</h2>
<p>The <code>modelTree</code> method for Cubist shows the usage of each variable in either the rule conditions or the (terminal) linear model. In actuality, many more linear models are used in prediction that are shown in the output. Because of this, the variable usage statistics shown at the end of the output of the <code>summary</code> function will probably be inconsistent with the rules also shown in the output. At each split of the tree, Cubist saves a linear model (after feature selection) that is allowed to have terms for each variable used in the current split or any split above it. Quinlan (1992) discusses a smoothing algorithm where each model prediction is a linear combination of the parent and child model along the tree. As such, the final prediction is a function of all the linear models from the initial node to the terminal node. The percentages shown in the Cubist output reflects all the models involved in prediction (as opposed to the terminal models shown in the output).</p>
<p>The raw usage statistics are contained in a data frame called <code>usage</code> in the <code>cubist</code> object.</p>
<p>The <code>caret</code> package has a general variable importance method <code>varImp</code>. When using this function on a <code>cubist</code> argument, the variable importance is a linear combination of the usage in the rule conditions and the model.</p>
<p>For example:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(model_tree)</span></code></pre></div>
<pre><code>## 
## Call:
## cubist.default(x = train_pred, y = train_resp)
## 
## 
## Cubist [Release 2.07 GPL Edition]  Tue Jan  7 12:20:02 2020
## ---------------------------------
## 
##     Target attribute `outcome'
## 
## Read 404 cases (14 attributes) from undefined.data
## 
## Model:
## 
##   Rule 1: [77 cases, mean 14.04, range 5 to 27.5, est err 2.14]
## 
##     if
##  nox &gt; 0.668
##     then
##  outcome = -2.18 + 3.47 dis + 21.6 nox - 0.32 lstat + 0.0089 b
##            - 0.12 ptratio - 0.02 crim - 0.005 age
## 
##   Rule 2: [167 cases, mean 19.30, range 7 to 31, est err 2.15]
## 
##     if
##  nox &lt;= 0.668
##  lstat &gt; 9.53
##     then
##  outcome = 43.02 - 0.94 ptratio - 0.27 lstat - 0.84 dis - 0.034 age
##            + 0.0082 b - 0.1 indus + 0.4 rm
## 
##   Rule 3: [29 cases, mean 25.08, range 18.2 to 50, est err 2.64]
## 
##     if
##  rm &lt;= 6.226
##  lstat &lt;= 9.53
##     then
##  outcome = -18.07 + 3.91 crim - 1.67 lstat + 0.0834 b + 3.3 rm
## 
##   Rule 4: [143 cases, mean 29.49, range 16.5 to 50, est err 2.39]
## 
##     if
##  dis &gt; 2.3999
##  lstat &lt;= 9.53
##     then
##  outcome = -28.26 + 11.1 rm + 0.62 crim - 0.58 lstat - 0.017 tax
##            - 0.059 age + 11.3 nox - 0.58 dis - 0.52 ptratio
## 
##   Rule 5: [14 cases, mean 40.54, range 22 to 50, est err 5.28]
## 
##     if
##  rm &gt; 6.226
##  dis &lt;= 2.3999
##  lstat &lt;= 9.53
##     then
##  outcome = -5.27 + 3.14 crim - 5.18 dis - 1.22 lstat + 9.6 rm
##            - 0.0141 tax - 0.031 age - 0.39 ptratio
## 
## 
## Evaluation on training data (404 cases):
## 
##     Average  |error|               2.13
##     Relative |error|               0.31
##     Correlation coefficient        0.96
## 
## 
##  Attribute usage:
##    Conds  Model
## 
##     82%   100%    lstat
##     57%    51%    nox
##     37%    93%    dis
##     10%    82%    rm
##            93%    age
##            93%    ptratio
##            63%    b
##            61%    crim
##            39%    indus
##            37%    tax
## 
## 
## Time: 0.0 secs</code></pre>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a>model_tree<span class="op">$</span>usage</span></code></pre></div>
<pre><code>##    Conditions Model Variable
## 1          82   100    lstat
## 2          57    51      nox
## 3          37    93      dis
## 4          10    82       rm
## 5           0    93      age
## 6           0    93  ptratio
## 7           0    63        b
## 8           0    61     crim
## 9           0    39    indus
## 10          0    37      tax
## 11          0     0       zn
## 12          0     0     chas
## 13          0     0      rad</code></pre>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(caret)</span>
<span id="cb26-2"><a href="#cb26-2"></a><span class="kw"><a href="https://rdrr.io/pkg/caret/man/varImp.html">varImp</a></span>(model_tree)</span></code></pre></div>
<pre><code>##         Overall
## lstat      91.0
## nox        54.0
## dis        65.0
## rm         46.0
## age        46.5
## ptratio    46.5
## b          31.5
## crim       30.5
## indus      19.5
## tax        18.5
## zn          0.0
## chas        0.0
## rad         0.0</code></pre>
<p>It should be noted that this variable importance measure does not capture the influence of the predictors when using the instance–based correction.</p>
</div>
<div id="tidy-rules" class="section level2">
<h2 class="hasAnchor">
<a href="#tidy-rules" class="anchor"></a>Tidy rules</h2>
<p>Rules from a Cubist model can be viewed using <code>summary</code> as follows:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(model_tree)</span></code></pre></div>
<pre><code>## 
## Call:
## cubist.default(x = train_pred, y = train_resp)
## 
## 
## Cubist [Release 2.07 GPL Edition]  Tue Jan  7 12:20:02 2020
## ---------------------------------
## 
##     Target attribute `outcome'
## 
## Read 404 cases (14 attributes) from undefined.data
## 
## Model:
## 
##   Rule 1: [77 cases, mean 14.04, range 5 to 27.5, est err 2.14]
## 
##     if
##  nox &gt; 0.668
##     then
##  outcome = -2.18 + 3.47 dis + 21.6 nox - 0.32 lstat + 0.0089 b
##            - 0.12 ptratio - 0.02 crim - 0.005 age
## 
##   Rule 2: [167 cases, mean 19.30, range 7 to 31, est err 2.15]
## 
##     if
##  nox &lt;= 0.668
##  lstat &gt; 9.53
##     then
##  outcome = 43.02 - 0.94 ptratio - 0.27 lstat - 0.84 dis - 0.034 age
##            + 0.0082 b - 0.1 indus + 0.4 rm
## 
##   Rule 3: [29 cases, mean 25.08, range 18.2 to 50, est err 2.64]
## 
##     if
##  rm &lt;= 6.226
##  lstat &lt;= 9.53
##     then
##  outcome = -18.07 + 3.91 crim - 1.67 lstat + 0.0834 b + 3.3 rm
## 
##   Rule 4: [143 cases, mean 29.49, range 16.5 to 50, est err 2.39]
## 
##     if
##  dis &gt; 2.3999
##  lstat &lt;= 9.53
##     then
##  outcome = -28.26 + 11.1 rm + 0.62 crim - 0.58 lstat - 0.017 tax
##            - 0.059 age + 11.3 nox - 0.58 dis - 0.52 ptratio
## 
##   Rule 5: [14 cases, mean 40.54, range 22 to 50, est err 5.28]
## 
##     if
##  rm &gt; 6.226
##  dis &lt;= 2.3999
##  lstat &lt;= 9.53
##     then
##  outcome = -5.27 + 3.14 crim - 5.18 dis - 1.22 lstat + 9.6 rm
##            - 0.0141 tax - 0.031 age - 0.39 ptratio
## 
## 
## Evaluation on training data (404 cases):
## 
##     Average  |error|               2.13
##     Relative |error|               0.31
##     Correlation coefficient        0.96
## 
## 
##  Attribute usage:
##    Conds  Model
## 
##     82%   100%    lstat
##     57%    51%    nox
##     37%    93%    dis
##     10%    82%    rm
##            93%    age
##            93%    ptratio
##            63%    b
##            61%    crim
##            39%    indus
##            37%    tax
## 
## 
## Time: 0.0 secs</code></pre>
<p>The <code>tidyRules</code> function in the <a href="https://talegari.github.io/tidyrules/"><code>tidyrules</code> package</a> returns rules in a tibble (an extension of dataframe) with one row per rule. The tibble provides these information about the rule: <code>support</code>, <code>mean</code>, <code>min</code>, <code>max</code>, <code>error</code>, <code>LHS</code>, <code>RHS</code> and <code>committee</code>. The values in <code>LHS</code> and <code>RHS</code> columns are strings which can be parsed as R expressions. These can be pasted inside the parenthesis of <code><a href="https://dplyr.tidyverse.org/reference/filter.html">dplyr::filter()</a></code> to obtain the rows of the data corresponding to the rule and evaluate the response variable.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(dplyr)</span>
<span id="cb30-2"><a href="#cb30-2"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(modeldata)</span>
<span id="cb30-3"><a href="#cb30-3"></a><span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"attrition"</span>)</span>
<span id="cb30-4"><a href="#cb30-4"></a>attrition &lt;-<span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/reexports.html">as_tibble</a></span>(attrition)</span>
<span id="cb30-5"><a href="#cb30-5"></a></span>
<span id="cb30-6"><a href="#cb30-6"></a><span class="co"># lets predict monthly income</span></span>
<span id="cb30-7"><a href="#cb30-7"></a>attrition_x &lt;-<span class="st"> </span>attrition <span class="op">%&gt;%</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="op">-</span>MonthlyIncome, <span class="op">-</span>Attrition)</span>
<span id="cb30-8"><a href="#cb30-8"></a>attrition_y &lt;-<span class="st"> </span>attrition <span class="op">%&gt;%</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(MonthlyIncome) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span>()</span>
<span id="cb30-9"><a href="#cb30-9"></a></span>
<span id="cb30-10"><a href="#cb30-10"></a>model_tree_attrition &lt;-<span class="st"> </span><span class="kw"><a href="../reference/cubist.default.html">cubist</a></span>(<span class="dt">x =</span> attrition_x, <span class="dt">y =</span> attrition_y)</span>
<span id="cb30-11"><a href="#cb30-11"></a></span>
<span id="cb30-12"><a href="#cb30-12"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(tidyrules)</span>
<span id="cb30-13"><a href="#cb30-13"></a></span>
<span id="cb30-14"><a href="#cb30-14"></a>tr &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/tidyrules/man/tidyRules.html">tidyRules</a></span>(model_tree_attrition)</span>
<span id="cb30-15"><a href="#cb30-15"></a>tr</span></code></pre></div>
<pre><code>## # A tibble: 8 x 9
##      id LHS            RHS            support   mean   min   max error committee
##   &lt;int&gt; &lt;chr&gt;          &lt;chr&gt;            &lt;int&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;int&gt;
## 1     1 JobLevel &lt;= 1  (2265) + (35 …     543  2787.  1009  4968  559.         1
## 2     2 JobLevel &gt; 1 … (-2092) + (32…      57  4459   2272  5301  328.         1
## 3     3 JobLevel &gt; 1 … (-39) + (2333…     124  4672.  2042  9724 1013.         1
## 4     4 JobLevel &gt; 1 … (1859) + (260…     387  6261.  2176  9998  995.         1
## 5     5 JobRole %in% … (-1136) + (35…     245  8469.  2592 13973  932.         1
## 6     6 JobRole %in% … (-1384.7) + (…      26 12857. 11031 17603  517.         1
## 7     7 JobLevel &lt;= 4… (4166.4) + (3…      87 15824  12061 17924  694.         1
## 8     8 JobLevel &gt; 4   (13633) + (10…      69 19192. 18041 19999  416          1</code></pre>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a>tr[, <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"LHS"</span>, <span class="st">"RHS"</span>)]</span></code></pre></div>
<pre><code>## # A tibble: 8 x 2
##   LHS                                     RHS                                   
##   &lt;chr&gt;                                   &lt;chr&gt;                                 
## 1 JobLevel &lt;= 1                           (2265) + (35 * TotalWorkingYears) + (…
## 2 JobLevel &gt; 1 &amp; TotalWorkingYears &lt;= 5   (-2092) + (3279 * JobLevel) + (27 * T…
## 3 JobLevel &gt; 1 &amp; JobRole %in% c('Laborat… (-39) + (2333 * JobLevel)             
## 4 JobLevel &gt; 1 &amp; JobRole %in% c('Healthc… (1859) + (2603 * JobLevel) - (98 * Ye…
## 5 JobRole %in% c('Healthcare_Representat… (-1136) + (3586 * JobLevel) + (19 * T…
## 6 JobRole %in% c('Manager', 'Research_Di… (-1384.7) + (4476 * JobLevel) - (0.01…
## 7 JobLevel &lt;= 4 &amp; JobRole %in% c('Manage… (4166.4) + (3467 * JobLevel) - (23 * …
## 8 JobLevel &gt; 4                            (13633) + (1076 * JobLevel) + (8 * To…</code></pre>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a><span class="co"># lets look at 7th rule</span></span>
<span id="cb34-2"><a href="#cb34-2"></a>tr<span class="op">$</span>LHS[<span class="dv">7</span>]</span></code></pre></div>
<pre><code>## [1] "JobLevel &lt;= 4 &amp; JobRole %in% c('Manager', 'Research_Director') &amp; TotalWorkingYears &gt; 14"</code></pre>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a>tr<span class="op">$</span>RHS[<span class="dv">7</span>]</span></code></pre></div>
<pre><code>## [1] "(4166.4) + (3467 * JobLevel) - (23 * Age) - (0.011 * MonthlyRate)"</code></pre>
<p>These results can be used to look at specific parts of the data. For example, the 7th rule predictions are:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(dplyr)</span>
<span id="cb38-2"><a href="#cb38-2"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(rlang)</span>
<span id="cb38-3"><a href="#cb38-3"></a></span>
<span id="cb38-4"><a href="#cb38-4"></a>char_to_expr &lt;-<span class="st"> </span><span class="cf">function</span>(x, <span class="dt">index =</span> <span class="dv">1</span>, <span class="dt">model =</span> <span class="ot">TRUE</span>) {</span>
<span id="cb38-5"><a href="#cb38-5"></a>  x &lt;-<span class="st"> </span>x <span class="op">%&gt;%</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span>(index) </span>
<span id="cb38-6"><a href="#cb38-6"></a>  <span class="cf">if</span> (model) {</span>
<span id="cb38-7"><a href="#cb38-7"></a>    x &lt;-<span class="st"> </span>x <span class="op">%&gt;%</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span>(RHS) <span class="op">%&gt;%</span><span class="st"> </span>rlang<span class="op">::</span><span class="kw"><a href="https://rlang.r-lib.org/reference/parse_expr.html">parse_expr</a></span>()</span>
<span id="cb38-8"><a href="#cb38-8"></a>  } <span class="cf">else</span> {</span>
<span id="cb38-9"><a href="#cb38-9"></a>    x &lt;-<span class="st"> </span>x <span class="op">%&gt;%</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span>(LHS) <span class="op">%&gt;%</span><span class="st"> </span>rlang<span class="op">::</span><span class="kw"><a href="https://rlang.r-lib.org/reference/parse_expr.html">parse_expr</a></span>()</span>
<span id="cb38-10"><a href="#cb38-10"></a>  }</span>
<span id="cb38-11"><a href="#cb38-11"></a>  x</span>
<span id="cb38-12"><a href="#cb38-12"></a>}</span>
<span id="cb38-13"><a href="#cb38-13"></a></span>
<span id="cb38-14"><a href="#cb38-14"></a>rule_expr  &lt;-<span class="st"> </span><span class="kw">char_to_expr</span>(tr, <span class="dv">7</span>, <span class="dt">model =</span> <span class="ot">FALSE</span>)</span>
<span id="cb38-15"><a href="#cb38-15"></a>model_expr &lt;-<span class="st"> </span><span class="kw">char_to_expr</span>(tr, <span class="dv">7</span>, <span class="dt">model =</span> <span class="ot">TRUE</span>)</span>
<span id="cb38-16"><a href="#cb38-16"></a></span>
<span id="cb38-17"><a href="#cb38-17"></a><span class="co"># filter the data corresponding to rule 7</span></span>
<span id="cb38-18"><a href="#cb38-18"></a>attrition <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb38-19"><a href="#cb38-19"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="kw"><a href="https://rlang.r-lib.org/reference/eval_tidy.html">eval_tidy</a></span>(rule_expr, attrition)) <span class="op">%&gt;%</span></span>
<span id="cb38-20"><a href="#cb38-20"></a><span class="st">  </span><span class="co"># evaluate the estimated MonthlyIncome</span></span>
<span id="cb38-21"><a href="#cb38-21"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">MonthlyIncome_est =</span> <span class="kw"><a href="https://rlang.r-lib.org/reference/eval_tidy.html">eval_tidy</a></span>(model_expr, .)) <span class="op">%&gt;%</span></span>
<span id="cb38-22"><a href="#cb38-22"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(MonthlyIncome, MonthlyIncome_est)</span></code></pre></div>
<pre><code>## # A tibble: 87 x 2
##    MonthlyIncome MonthlyIncome_est
##            &lt;int&gt;             &lt;dbl&gt;
##  1         15427            16573.
##  2         13458            13642.
##  3         14756            16552.
##  4         13245            13367.
##  5         13664            13439.
##  6         13549            13061.
##  7         17328            16640.
##  8         16959            16831.
##  9         17181            16950.
## 10         16792            16774.
## # … with 77 more rows</code></pre>
</div>
<div id="exporting-the-model-using-the-rulequest-file-format" class="section level2">
<h2 class="hasAnchor">
<a href="#exporting-the-model-using-the-rulequest-file-format" class="anchor"></a>Exporting the Model Using the RuleQuest file format</h2>
<p>As previously mentioned, this code is a port of the command–line <code>C</code> code. To run the <code>C</code> code, the training set data must be converted to a specific file format as detailed on the RuleQuest website. Two files are created. The <code>file.data</code> file is a header–less, comma delimited version of the data (the <code>file</code> part is a name given by the user). The <code>file.names</code> file provides information about the columns (eg. levels for categorical data and so on). After running the <code>C</code> program, another text file called <code>file.models</code>, which contains the information needed for prediction.</p>
<p>Once a model has been built with the <code>R</code> <code>cubist</code> package, the <code>exportCubistFiles</code> can be used to create the <code>.data</code>, <code>.names</code> and <code>.model</code> files so that the same model can be run at the command–line.</p>
</div>
<div id="current-limitations" class="section level2">
<h2 class="hasAnchor">
<a href="#current-limitations" class="anchor"></a>Current Limitations</h2>
<p>There are a few features in the <code>C</code> code that are not yet operational in the <code>R</code> package:</p>
<ul>
<li>only continuous and categorical predictors can be used (the original source code allows for other data types)</li>
<li>there is an option to let the <code>C</code> code decide on using instances or not. The choice is more explicit in this package</li>
<li>non–standard predictor names are not currently checked/fixed</li>
<li>the <code>C</code> code supports binning of predictors</li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#model-trees">Model Trees</a></li>
      <li><a href="#ensembles-by-committees">Ensembles By Committees</a></li>
      <li><a href="#instancebased-corrections">Instance–Based Corrections</a></li>
      <li><a href="#variable-importance">Variable Importance</a></li>
      <li><a href="#tidy-rules">Tidy rules</a></li>
      <li><a href="#exporting-the-model-using-the-rulequest-file-format">Exporting the Model Using the RuleQuest file format</a></li>
      <li><a href="#current-limitations">Current Limitations</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Max Kuhn, Ross Quinlan.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
